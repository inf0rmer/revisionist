/**
 *  v0.4.0
 *
 * Copyright (c) 2013Bruno Abrantes
 * Distributed under MIT License
 *
 * Documentation and full license available at:
 * http://inf0rmer.github.com/revisionist
 *
 */
!function(a){if("function"==typeof bootstrap)bootstrap("revisionist",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeRevisionist=a}else"undefined"!=typeof window?window.Revisionist=a():global.Revisionist=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){function c(a){var b=a;return b=b.replace(/&/g,"&amp;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;"),b=b.replace(/"/g,"&quot;")}function d(a,b){a=a.replace(/\s+$/,""),b=b.replace(/\s+$/,"");var d=e(""==a?[]:a.split(/\s+/),""==b?[]:b.split(/\s+/)),f="",g=a.match(/\s+/g);null==g?g=["\n"]:g.push("\n");var h=b.match(/\s+/g);if(null==h?h=["\n"]:h.push("\n"),0==d.n.length)for(var i=0;i<d.o.length;i++)f+="<del>"+c(d.o[i])+g[i]+"</del>";else{if(null==d.n[0].text)for(b=0;b<d.o.length&&null==d.o[b].text;b++)f+="<del>"+c(d.o[b])+g[b]+"</del>";for(var i=0;i<d.n.length;i++)if(null==d.n[i].text)f+="<ins>"+c(d.n[i])+h[i]+"</ins>";else{var j="";for(b=d.n[i].row+1;b<d.o.length&&null==d.o[b].text;b++)j+="<del>"+c(d.o[b])+g[b]+"</del>";f+=" "+d.n[i].text+h[i]+j}}return f}function e(a,b){for(var c=new Object,d=new Object,e=0;e<b.length;e++)null==c[b[e]]&&(c[b[e]]={rows:new Array,o:null}),c[b[e]].rows.push(e);for(var e=0;e<a.length;e++)null==d[a[e]]&&(d[a[e]]={rows:new Array,n:null}),d[a[e]].rows.push(e);for(var e in c)1==c[e].rows.length&&"undefined"!=typeof d[e]&&1==d[e].rows.length&&(b[c[e].rows[0]]={text:b[c[e].rows[0]],row:d[e].rows[0]},a[d[e].rows[0]]={text:a[d[e].rows[0]],row:c[e].rows[0]});for(var e=0;e<b.length-1;e++)null!=b[e].text&&null==b[e+1].text&&b[e].row+1<a.length&&null==a[b[e].row+1].text&&b[e+1]==a[b[e].row+1]&&(b[e+1]={text:b[e+1],row:b[e].row+1},a[b[e].row+1]={text:a[b[e].row+1],row:e+1});for(var e=b.length-1;e>0;e--)null!=b[e].text&&null==b[e-1].text&&b[e].row>0&&null==a[b[e].row-1].text&&b[e-1]==a[b[e].row-1]&&(b[e-1]={text:b[e-1],row:b[e].row-1},a[b[e].row-1]={text:a[b[e].row-1],row:e-1});return{o:a,n:b}}b.exports=d},{}],2:[function(a,b){var c;c=function(a,b){var d;null==a&&(a={});for(d in b)a[d]="object"==typeof b[d]?c(a[d],b[d]):b[d];return a},b.exports=c},{}],3:[function(a,b){var c;c={update:function(a){return a},recover:function(a){return a}},b.exports=c},{}],4:[function(a,b){var Revisionist,c,d,e,f;f=a("./lib/diff"),e=a("./lib/extend.coffee"),Revisionist=function(){function Revisionist(a){this.options={},e(this.options,this.defaults),e(this.options,a),this.setStore(this.options.store)}var a,b,c,d,g;return c={},g={},a=0,d=null,b=function(){var b;return b=a-1,0>b&&(b=0),b},Revisionist.registerPlugin=function(a,b){if(null!=c[a])throw new Error("There's already a plugin in this namespace");return c[a]=b},Revisionist.unregisterPlugin=function(a){return c[a]=null},Revisionist.registerStore=function(a,b){if(null!=g[a])throw new Error("There's already a store in this namespace");return g[a]=b},Revisionist.unregisterStore=function(a){return g[a]=null},Revisionist.prototype.defaults={versions:10,plugin:"simple",store:"simple"},Revisionist.prototype.getLatestVersionNumber=function(){return a-1},Revisionist.prototype.setStore=function(a){var b;if(b=g[a],null==b)throw new Error("The Store '"+a+"' is not available!");return d=new b(this.options)},Revisionist.prototype.update=function(b){var e;if(e=c[this.options.plugin],null==(null!=e?e.update:void 0))throw new Error("Plugin "+this.options.plugin+" is not available!");return b=e.update.call(e,b),a+=1,d.set(b,a),a>this.options.versions&&(d.remove(0),a=d.size()),b},Revisionist.prototype.recover=function(a,e){var f;if(f=c[this.options.plugin],null==(null!=f?f.recover:void 0))throw new Error("Plugin "+this.options.plugin+" is not available!");if(null==a&&(a=b()),0>a)throw new Error("Version needs to be a positive number");if(a>d.size())throw new Error("This version doesn't exist");return"function"==typeof e?d.get(a,function(a){return e(f.recover.call(f,a))}):void 0},Revisionist.prototype.diff=function(b,c,e){var f,g;return null==b&&(b=a-1,0>b&&(b=0)),null==c&&(c=b-1,0>c&&(c=0)),g=Math.min(b,c),f=Math.max(b,c),"function"==typeof e?d.get(g,function(a){return d.get(f,function(b){return e({old:a,"new":b})})}):void 0},Revisionist.prototype.visualDiff=function(a,b,c){return this.diff(a,b,function(a){if("string"!=typeof a.old||"string"!=typeof a["new"])throw new Error("The content types of both versions must match");return c(f(a.old,a["new"]))})},Revisionist.prototype.clear=function(){return d.clear(),a=0,this},Revisionist}(),c=a("./plugins/simple.coffee"),Revisionist.registerPlugin("simple",c),d=a("./stores/simple.coffee"),Revisionist.registerStore("simple",d),b.exports=Revisionist},{"./lib/diff":1,"./lib/extend.coffee":2,"./plugins/simple.coffee":3,"./stores/simple.coffee":5}],5:[function(a,b){var c;c=function(){function a(a){this.options=a}var b;return b=[],a.prototype.set=function(a){return b.push(a)},a.prototype.get=function(a,c){return c(b[a])},a.prototype.remove=function(a){return b.splice(a,1)},a.prototype.clear=function(){return b=[]},a.prototype.size=function(){return b.length},a}(),b.exports=c},{}]},{},[4])(4)});